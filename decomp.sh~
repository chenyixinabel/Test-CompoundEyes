#!/bin/bash

#Usage ./decomp <videos_folder> <frames_folder> <format of frames>
#Folders should end with "/"
#ls -1 $1/ | cut -d . -f 1 |xargs -i mkdir $2/{}
#ls -1 $1/ | cut -d . -f 1 |xargs -i ffmpeg -i $1/{}.* -vf select='eq(pict_type\,I)' -vsync 0 $2/{}/I-Frames%d.$3

mkdir $2
ls -1 $1 | awk -v ffrm=$2 -F '.' '{system("mkdir "ffrm$1)}'
chmod -R 777 $2
ls -1 $1 | awk -v fvid=$1 -v ffrm=$2 -v fmf=$3 -v bs="\\"  -F "." '{system("ffmpeg -i "fvid$1"."$2" -vf select='''\''''eq(pict_type"bs",PICT_TYPE_I)'''\'''' -vsync 0 "ffrm$1"/I-Frames%d."fmf)}'
#ls -1 $1 | awk -v fvid=$1 -v ffrm=$2 -v fmf=$3 -F '.' '{system("ffmpeg -i "fvid$1"."$2" -r "rate" "ffrm$1"/I-Frames%d."fmf)}'
#ls -1 $1 | awk -v fvid=$1 -v ffrm=$2 -v fmf=$3 -F '.' '{
#	cmd = "ffmpeg -i "fvid$1"."$2" 2>&1 | sed -n \"s/.*, \\(.*\\) tbr.*/\\1/p\""
#	while(cmd | getline fps > 0){
#		rate = fps / 15
#		system("ffmpeg -i "fvid$1"."$2" -r "rate" "ffrm$1"/I-Frames%d."fmf"&")
#		}
#	}'



